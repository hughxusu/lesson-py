# 任务清单

任务清单的需求如下：

1. 程序可以持续执行，接收用户的命令，并完成相应的功能。
2. 使用命令操作控制任务的添加、删除、编辑和设置完成或未完成。
   * `add [任务内容]`将任务添加到任务清单中。
   * `del [index]`删除任务条目（`index`表示任务序号）。
   * `ok [index]`设置任务为完成。
   * `undo [index]`设置任务为未完成。
   * `edit [index] [任务内容]`修改任务的内容。
   * `help`查询命令清单。
   * `show`显示任务列表。
   * `exit`退出系统。
3. 进入系统后，提示所有的操作命令。
4. 任务清单可以保存成`pkl`数据，系统启动时自动读取，系统关闭是自动保存。

任务清单中每个任务的设计如下

```python
class TodoItem:
    def __init__(self, desc):
        self.desc = desc
        self.is_completed = False

    def __str__(self):
        return f'{'✅' if self.is_completed else '⭕️'}  {self.desc}'
```

## 创建清单类

任务清单中应该包含多个`TodoItem`，并可以循环运行。初始化任务清单类

```python
class TodoList:
    def __init__(self):
        self.items = []

    def run(self):
        while True:
            raw = input('')
            if raw == 'exit':
                break
            else:
                print(raw)

todo_list = TodoList()
todo_list.run()
```

### 操作提示

增加`help`命令和操作命令提示函数。

```python
class TodoList:
    def __init__(self):
        self.__items = []

    def __help(self):
        print('show 显示任务列表。')
        print('add [任务内容] 将任务添加到任务清单中。')
        print('del [index] 删除任务条目（index表示任务序号）。')
        print('ok [index] 设置任务为完成。')
        print('undo [index] 设置任务为未完成')
        print('edit [index] [任务内容] 修改任务的内容。')
        print('help 查询命令清单。')
        print('exit 退出系统。')
        print('=' * 100)

    def __short_info(self):
        print('-' * 100)
        print(f'当前任务数量{len(self.items)}，操作命令如下：')
        print('show; exit; help; add [任务描述]; del [index]; ok [index]; undo [index]; edit [index] [任务内容]')
        print('=' * 100)

    def run(self):
        print('=' * 100)
        print('欢迎使用任务清单')
        self.__short_info()
        while True:
            raw = input('').strip()
            if raw == 'exit':
                break
            elif raw == 'help':
                self.__help()
            else:
                print(raw)
```

* 其中`__help`为帮助信息显示；`__short_info`提示系统信息。
* 由于两个函数只需要再`run`函数内调用，所以设置为私有函数。
* 对于`TodoList`来说，用户只需要调用`run`函数即可运行程序，其它函数不需要用户调用，均可以定义为私有。
* 同理，对于任务列表也应该拒绝调用者访问，设置为私有。

### 静态方法

静态方法是绑定在类上的单独函数，封装逻辑上属于类，但不依赖于类或任何的实例。它既不能访问实例属性，也不能访问类属性。使用`@staticmethod`装饰函数，将其定义为静态方法。

```python
@staticmethod
def __help():
    print('=' * 100)
    print('show 显示任务列表。')
    print('add [任务内容] 将任务添加到任务清单中。')
    print('del [index] 删除任务条目（index表示任务序号）。')
    print('ok [index] 设置任务为完成。')
    print('undo [index] 设置任务为未完成')
    print('edit [index] [任务内容] 修改任务的内容。')
    print('help 查询命令清单。')
    print('exit 退出系统。')
    print('=' * 100)
```

* `__help`函数仅为打印帮助信息，不需要访问任何类属性或示例属性，可以设计为静态方法。

## 添加功能方法

任务清单中的命令可以分为两类：

1. 不带参数的命令，如：`help`、`show`等。
2. 带参数的命令，如：`add`、`del`等。

对于不带参数的命令，可以直接执行；对于带参数的命令应该可以解析出命令和参数。

### 解析命令和参数

```python
class TodoList:
    def __init__(self):
        self.__items = []
        self.__cmds = ['add', 'del', 'ok', 'undo', 'edit']

    def __parse_cmd(self, raw):
        tokens = raw.split(' ', 1)
        if len(tokens) == 0:
            return None, None
        cmd = tokens[0]
        if cmd not in self.__cmds:
            return None, None
        return cmd, tokens[1:]

    def run(self):
        print('=' * 100)
        print('欢迎使用任务清单')
        self.__short_info()
        while True:
            raw = input('').strip()
            if raw == 'exit':
                break
            elif raw == 'help':
                self.__help()
            else:
                cmd, args = self.__parse_cmd(raw)
                if cmd is None:
                    print('命令格式错误，请输入正确的命令。')
                else:
                    print(f'执行命令{cmd}，参数{args}')
```

* `__parse_cmd`函数将命令拆分成两部分，一部分是命令，另一部分是参数。
* 如果命令格式不正确，返回为空。

### 添加任务

解析领了后，如果是`add`命令可以添加一条新的任务。

```python
def __add_item(self, args):
    if len(args) == 0 or args[0].strip() == '':
        print('请输入任务内容。')
    else:
        self.__items.append(TodoItem(args[0].strip()))
        print('任务添加成功。')

def run(self):
    print('=' * 100)
    print('欢迎使用任务清单')
    self.__short_info()
    while True:
        raw = input('').strip()
        if raw == 'exit':
            break
        elif raw == 'help':
            self.__help()
        else:
            cmd, args = self.__parse_cmd(raw)
            if cmd == 'add':
                self.__add_item(args)
            else:
                print('命令格式错误，请输入正确的命令。')
```

* 如果判断命令参数为空，或参数为空字符串，提示用户输入任务内容，否则将内容添加到任务清单中。

### 查看任务

添加完任务后应该可以查看任务是否添加成功

```python
def __show_items(self):
    print('=' * 100)
    if len(self.__items) == 0:
        print('当前任务列表为空。')
    else:
        for i, item in enumerate(self.__items, 1):
            print(f'{i}. {item}')
    self.__short_info()

def run(self):
    print('=' * 100)
    print('欢迎使用任务清单')
    self.__short_info()
    while True:
        raw = input('').strip()
        if raw == 'exit':
            break
        elif raw == 'help':
            self.__help()
        elif raw == 'show':
            self.__show_items()
        else:
            cmd, args = self.__parse_cmd(raw)
            if cmd == 'add':
                self.__add_item(args)
            else:
                print('命令格式错误，请输入正确的命令。')
```

* `__show_items`中遍历并打印所有的任务项，由于`TodoItem`覆盖了`__str__`方法，所以直接打印就可以。

### 设置任务状态

任务包括：完成和未完成两种状态，可以使用同一个函数进行设置。

```python
def __set_item_status(self, args, is_completed=True):
    if len(args) == 0 or args[0].strip() == '':
        print('请输入任务序号。')
    else:
        index = args[0].strip()
        if not index.isdigit():
            print('请输入正确的任务序号。')
        else:
            index = int(index) - 1
            if index < 0 or index >= len(self.__items):
                print('任务序号不存在。')
            else:
                self.__items[index].is_completed = is_completed
                print(f'任务设置为{"完成" if is_completed else "未完成"}。')

def run(self):
    print('=' * 100)
    print('欢迎使用任务清单')
    self.__short_info()
    while True:
        raw = input('').strip()
        if raw == 'exit':
            break
        elif raw == 'help':
            self.__help()
        elif raw == 'show':
            self.__show_items()
        else:
            cmd, args = self.__parse_cmd(raw)
            if cmd == 'add':
                self.__add_item(args)
            elif cmd == 'ok':
                self.__set_item_status(args)
            elif cmd == 'undo':
                self.__set_item_status(args, False)
            else:
                print('命令格式错误，请输入正确的命令。')
```

* `ok`命令和`undo`命令使用同一函数`__set_item_status`来设置任务状态，函数默认状态为`True`。
* 设置任务状态时，应该检查`index`参数是否存在。

### 删除任务

删除任务的逻辑和设置任务状态类似。

```python
def __del_item(self, args):
    if len(args) == 0 or args[0].strip() == '':
        print('请输入任务序号。')
    else:
        index = args[0].strip()
        if not index.isdigit():
            print('请输入正确的任务序号。')
        else:
            index = int(index) - 1
            if index < 0 or index >= len(self.__items):
                print('任务序号不存在。')
            else:
                del self.__items[index]
                print('任务删除成功。')

def run(self):
    print('=' * 100)
    print('欢迎使用任务清单')
    self.__short_info()
    while True:
        raw = input('').strip()
        if raw == 'exit':
            break
        elif raw == 'help':
            self.__help()
        elif raw == 'show':
            self.__show_items()
        else:
            cmd, args = self.__parse_cmd(raw)
            if cmd == 'add':
                self.__add_item(args)
            elif cmd == 'ok':
                self.__set_item_status(args)
            elif cmd == 'undo':
                self.__set_item_status(args, False)
            elif cmd == 'del':
                self.__del_item(args)
            else:
                print('命令格式错误，请输入正确的命令。')
```

### 编辑任务

编辑任务的参数实际上包含两个：序号（`[index]`）和内容（`[任务内容]`）。所以解析完命令后需要对参数进一步拆分。

* 可以定义一个新的函数，用于拆分参数。
* 可以改造`__parse_cmd`可以同时解析和拆分参数。

```python
def __parse_cmd(self, raw, is_cmd=True):
    tokens = raw.split(' ', 1)
    if is_cmd:
        if len(tokens) == 0:
            return None, None
        cmd = tokens[0]
        if cmd not in self.__cmds:
            return None, None
        return cmd, tokens[1:]
    else:
        if len(tokens) == 0:
            return None, None
        index = tokens[0].strip()
        if not index.isdigit():
            return None, None
        index = int(index) - 1
        if index < 0 or index >= len(self.__items):
            return None, None
        return index, tokens[1:]

def __edit_item(self, args):
    index, args = self.__parse_cmd(args[0], False)
    if index is None:
        print('请输入正确的任务序号。')
    else:
        if len(args) == 0 or args[0].strip() == '':
            print('请输入任务内容。')
        else:
            self.__items[index].desc = args[0].strip()
            print('任务修改成功。')

def run(self):
    print('=' * 100)
    print('欢迎使用任务清单')
    self.__short_info()
    while True:
        raw = input('').strip()
        if raw == 'exit':
            break
        elif raw == 'help':
            self.__help()
        elif raw == 'show':
            self.__show_items()
        else:
            cmd, args = self.__parse_cmd(raw)
            if cmd == 'add':
                self.__add_item(args)
            elif cmd == 'ok':
                self.__set_item_status(args)
            elif cmd == 'undo':
                self.__set_item_status(args, False)
            elif cmd == 'del':
                self.__del_item(args)
            elif cmd == 'edit':
                self.__edit_item(args)
            else:
                print('命令格式错误，请输入正确的命令。')
```

* 给`__parse_cmd`增加新功能，当`is_cmd=True`时用于拆分命令，否则用于拆分参数。并增加参数判断的规则。
* 编辑任务与添加任务类似，都需要对字符串内容进行判断。

> [!Note]
>
> 数据的保存和读取应该如何设计。
